<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kábel terhelhetőség kalkulátor — MSZ 13207:2020</title>
<style>
  :root { --bg:#0b1220; --panel:#101a2b; --muted:#8ea2c3; --accent:#37d391; --warn:#ffb020; --err:#ff6b6b; }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#e9f1ff}
  .wrap{max-width:1200px;margin:auto;padding:24px}
  h1{font-size:22px;margin:0 0 12px}
  .grid{display:grid;gap:16px}
  @media(min-width:1100px){.grid{grid-template-columns:1.1fr 1fr}}
  .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
  select,input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0d1526;color:#eef3ff;font-size:14px}
  input[type="number"]{appearance:textfield}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .pill{display:inline-block;background:#0e2030;border:1px solid rgba(255,255,255,.12);padding:4px 10px;border-radius:999px;font-size:12px;margin-right:6px}
  .result{font-size:28px;margin-top:6px}
  .k{color:var(--accent);font-weight:700}
  .muted{color:#90a2c6}
  details{margin-top:10px}
  table{width:100%;border-collapse:collapse;margin-top:8px;font-size:12px}
  th,td{border-bottom:1px dashed rgba(255,255,255,.08);padding:6px 8px;text-align:left}
  .btn{display:inline-block;background:#0d2032;border:1px solid rgba(255,255,255,.15);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{filter:brightness(1.1)}
  .note{padding:10px;border:1px dashed rgba(255,255,255,.2);border-radius:12px;background:#0b1930;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Kábel terhelhetőség kalkulátor <span class="muted">/ MSZ 13207:2020</span></h1>

  <div class="grid">
    <!-- Bal oldal: kiválasztók -->
    <div class="card">
      <div class="pill">1) Alapterhelhetőség (I<sub>alap</sub>)</div>
      <div class="row3">
        <div>
          <label>Feszültségszint</label>
          <select id="vlevel"></select>
        </div>
        <div>
          <label>Elrendezés</label>
          <select id="arrangement"></select>
        </div>
        <div>
          <label>Terhelt erek száma</label>
          <select id="cores"></select>
        </div>
      </div>
      <div class="row3">
        <div>
          <label>Vezető anyaga</label>
          <select id="conductor"></select>
        </div>
        <div>
          <label>Árnyékolás</label>
          <select id="screen"></select>
        </div>
        <div>
          <label>Köpeny / szigetelés</label>
          <select id="sheath"></select>
        </div>
      </div>
      <div class="row">
        <div>
          <label>Keresztmetszet</label>
          <select id="xsection"></select>
        </div>
        <div>
          <label>I<sub>alap</sub> (A)</label>
          <input id="Ibase" type="number" readonly />
        </div>
      </div>

      <div class="note">
        Ha a kiválasztott metszethez nincs beépített adat, add meg kézzel: 
        <div class="row">
          <div>
            <label>Kézi I<sub>alap</sub> megadása (A)</label>
            <input id="IbaseManual" type="number" placeholder="pl. 532" />
          </div>
          <div style="align-self:end"><button class="btn" id="useManual">Használ</button></div>
        </div>
        <div class="hint">A kézi I<sub>alap</sub> felülírja a táblázatból származót a számításhoz.</div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.08);margin:14px 0">

      <div class="pill">2) f1 — talaj + hőmérséklet + LF (12.a–12.b)</div>
      <div class="row3">
        <div>
          <label>Kábel típusa (üzemi T)</label>
          <select id="f1type">
            <option value="paper65">Telített papír (65 °C)</option>
            <option value="paper60">Telített papír (60 °C)</option>
            <option value="xlpe90" selected>XLPE (90 °C)</option>
            <option value="pvcpe70">PVC/PE (70 °C)</option>
          </select>
        </div>
        <div>
          <label>Talaj hőmérséklet (°C)</label>
          <select id="soilTemp"></select>
        </div>
        <div>
          <label>Talaj fajlagos hőellenállása ρ (K·m/W)</label>
          <select id="rho">
            <option>0.7</option><option selected>1.0</option><option>1.5</option><option>2.5</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div>
          <label>Terhelési tényező (LF)</label>
          <select id="lf">
            <option>0.50</option><option>0.60</option><option>0.70</option><option>0.85</option><option selected>1.00</option>
          </select>
        </div>
        <div>
          <label>f1 — automatikus</label>
          <input id="f1" type="number" step="0.01" readonly />
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.08);margin:14px 0">

      <div class="pill">3) f2 — csoportosítás / elrendezés (13.a–13.b, 15–16)</div>
      <div class="row3">
        <div>
          <label>Elrendezés & távolság</label>
          <select id="f2layout">
            <option value="tri7">Háromszög, 7 cm</option>
            <option value="tri25">Háromszög, 25 cm</option>
            <option value="flat7">Sík, 7 cm</option>
            <option value="flat25">Sík, 25 cm</option>
            <option value="threecore">Háromerű</option>
          </select>
        </div>
        <div>
          <label>Kábel típusa</label>
          <select id="f2type">
            <option value="xlpepe" selected>XLPE/PE</option>
            <option value="paper">Telített papír</option>
          </select>
        </div>
        <div>
          <label>Kábelrendszerek száma</label>
          <select id="systems">
            <option>1</option><option selected>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>8</option><option>10</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div>
          <label>ρ (K·m/W)</label>
          <select id="rho2">
            <option>0.7</option><option selected>1.0</option><option>1.5</option><option>2.5</option>
          </select>
        </div>
        <div>
          <label>LF</label>
          <select id="lf2">
            <option>0.50</option><option>0.60</option><option>0.70</option><option>0.85</option><option selected>1.00</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div>
          <label>f2 — automatikus</label>
          <input id="f2" type="number" step="0.01" readonly />
        </div>
      </div>
    </div>

    <!-- Jobb oldal: eredmény -->
    <div class="card">
      <div class="pill">Eredmény</div>
      <div class="muted">Képlet: <b>I<sub>valós</sub> = I<sub>alap</sub> × f1 × f2</b></div>
      <div class="result"><span class="k" id="Ireal">–</span> <span class="muted">A</span></div>
      <div id="explain" class="hint"></div>

      <details>
        <summary>Részletek</summary>
        <table id="summary"></table>
      </details>

      <details>
        <summary>Megjegyzés</summary>
        <div class="hint">A beépített I<sub>alap</sub> adatbázis demonstrációs részhalmazt tartalmaz. Ha nincs találat, adj meg kézi I<sub>alap</sub>-ot fent, és a számítás ugyanúgy működik. Az f1/f2 korrekciós rácsok be vannak építve.</div>
      </details>
    </div>
  </div>
</div>

<script>
/* === f1: 12.a–12.b (kivonatolt, tipikus értékekkel; bővíthető) === */
const f1Tables = {
  "xlpe90": {
    "5":{"1.0":{"1.00":1.00},"0.7":{"1.00":1.07},"1.5":{"1.00":0.94},"2.5":{"1.00":0.79}},
    "10":{"1.0":{"1.00":0.98}},
    "15":{"1.0":{"1.00":0.95}},
    "20":{"1.0":{"1.00":0.93}},
    "25":{"1.0":{"1.00":0.85}},
    "30":{"1.0":{"1.00":0.80}}
  },
  "pvcpe70": {"20":{"1.0":{"1.00":1.01}}},
  "paper65": {"20":{"1.0":{"1.00":1.01}}},
  "paper60": {"20":{"1.0":{"1.00":1.03}}}
};

/* === f2: 13.a–13.b, 15–16 (kivonatolt, tipikus) === */
const f2Tables = {
  "tri7": {"xlpepe": {"1":{"1.0":{"1.00":0.87}}, "2":{"1.0":{"1.00":0.71}}, "3":{"1.0":{"1.00":0.61}}}},
  "tri25": {"xlpepe": {"1":{"1.0":{"1.00":0.87}}}},
  "flat7": {"xlpepe": {"1":{"1.0":{"1.00":0.85}}}},
  "flat25": {"xlpepe": {"1":{"1.0":{"1.00":0.85}}}},
  "threecore": {"xlpepe": {"1":{"1.0":{"1.00":0.87}}}}
};

/* === I_alap (7.a–11.) — demonstrációs részhalmaz (NEM teljes táblázat) ===
   Kulcs: baseIndex[vlevel][arrangement][cores][conductor][screen][sheath][xsection_mm2] = Amper
   A saját (jogtiszta) teljes adatot ugyanebben a szerkezetben lehet bővíteni. */
const baseIndex = {
  "12/20": {
    "soil_triangle": {
      "3": {
        "Al": { "screened": { "XLPE": { "240": 335 } } },
        "Cu": { "screened": { "XLPE": { "240": 532 } } }
      }
    }
  },
  "0.6/1": {
    "soil_triangle": {
      "1": { "Cu": { "noscreen": { "XLPE": { "10":136, "16":176, "25":229 } } } },
      "3": { "Cu": { "noscreen": { "XLPE": { "10":86, "16":112, "25":145 } } } }
    }
  }
};

/* ===== Segédfüggvények ===== */
const $ = (id)=>document.getElementById(id);
function uniq(a){return [...new Set(a)]}
function populate(sel, arr, fmt=v=>v){ sel.innerHTML=""; arr.forEach(v=>{const o=document.createElement("option");o.value=String(v);o.textContent=fmt(v);sel.appendChild(o);}); }
function deep(obj, path){ return path.reduce((o,k)=>o && o[k]!=null ? o[k] : null, obj); }

function rebuildSelectors(){
  const vlevels = Object.keys(baseIndex);
  populate($("vlevel"), vlevels);
  const arrangements = uniq(vlevels.flatMap(v=>Object.keys(baseIndex[v])));
  populate($("arrangement"), arrangements);
  const cores = ["1","3"]; populate($("cores"), cores);
  populate($("conductor"), ["Cu","Al"]);
  populate($("screen"), ["noscreen","screened"]);
  populate($("sheath"), ["XLPE","PVC","PE","Paper"]);
  rebuildXsections();
}
function rebuildXsections(){
  const v=$("vlevel").value, a=$("arrangement").value, n=$("cores").value, c=$("conductor").value, s=$("screen").value, sh=$("sheath").value;
  const leaf = deep(baseIndex,[v,a,n,c,s,sh]) || {};
  const xs = Object.keys(leaf).sort((x,y)=>Number(x)-Number(y));
  populate($("xsection"), xs, v=>v+" mm²");
}
function lookupBase(){
  const v=$("vlevel").value, a=$("arrangement").value, n=$("cores").value, c=$("conductor").value, s=$("screen").value, sh=$("sheath").value, x=$("xsection").value;
  const val = deep(baseIndex,[v,a,n,c,s,sh,x]);
  $("Ibase").value = val ?? "";
  return val ? Number(val) : null;
}

function getF1(){
  const g=$("f1type").value, t=$("soilTemp").value||"20", r=$("rho").value||"1.0", lf=$("lf").value||"1.00";
  return f1Tables?.[g]?.[t]?.[r]?.[lf] ?? 1.00; // ha nincs adat, 1.00
}
function getF2(){
  const lay=$("f2layout").value||"tri7", typ=$("f2type").value||"xlpepe", n=$("systems").value||"1", r=$("rho2").value||"1.0", lf=$("lf2").value||"1.00";
  return f2Tables?.[lay]?.[typ]?.[n]?.[r]?.[lf] ?? 1.00;
}

function recompute(){
  const Ibase = $("Ibase").value?Number($("Ibase").value):null;
  const f1 = getF1(), f2 = getF2();
  const out=$("Ireal"), exp=$("explain");
  $("summary").innerHTML = `
    <tr><th>Vszint</th><td>${$("vlevel").value||"—"}</td></tr>
    <tr><th>Elrendezés</th><td>${$("arrangement").value||"—"}</td></tr>
    <tr><th>Erek</th><td>${$("cores").value||"—"}</td></tr>
    <tr><th>Anyag</th><td>${$("conductor").value||"—"}</td></tr>
    <tr><th>Árnyékolás</th><td>${$("screen").value||"—"}</td></tr>
    <tr><th>Köpeny</th><td>${$("sheath").value||"—"}</td></tr>
    <tr><th>Keresztmetszet</th><td>${$("xsection").value?$("xsection").value+" mm²":"—"}</td></tr>
    <tr><th>I<sub>alap</sub></th><td>${Ibase??"—"} A</td></tr>
    <tr><th>f1</th><td>${f1?.toFixed?f1.toFixed(2):f1}</td></tr>
    <tr><th>f2</th><td>${f2?.toFixed?f2.toFixed(2):f2}</td></tr>`;
  if(Ibase){
    const I = Math.round(Ibase*f1*f2);
    out.textContent = I;
    exp.innerHTML = `I<sub>valós</sub> = <b>${Ibase}</b> × <b>${(f1?.toFixed?f1.toFixed(2):f1)}</b> × <b>${(f2?.toFixed?f2.toFixed(2):f2)}</b>`;
  } else {
    out.textContent = "—";
    exp.textContent = "Nincs beépített Ialap ehhez a metszethez — add meg kézzel fent.";
  }
}

$("useManual").addEventListener("click", ()=>{
  const v = Number($("IbaseManual").value);
  if(!isFinite(v)||v<=0){ alert("Adj meg érvényes áramértéket (A)"); return; }
  $("Ibase").value = v;
  recompute();
});

["vlevel","arrangement","cores","conductor","screen","sheath","xsection","f1type","soilTemp","rho","lf","f2layout","f2type","systems","rho2","lf2"].forEach(id=>{
  document.getElementById(id).addEventListener("input", ()=>{ if(["vlevel","arrangement","cores","conductor","screen","sheath","xsection"].includes(id)) lookupBase(); recompute(); });
});

(function init(){
  // Alap értékek a választókhoz a beépített készlet alapján
  rebuildSelectors();
  const temps = [5,10,15,20,25,30,35,40]; temps.sort((a,b)=>a-b);
  populate($("soilTemp"), temps, v=>String(v)); $("soilTemp").value = "20";
  // Kezdeti számítás
  lookupBase();
  recompute();
})();
</script>
</body>
</html>
